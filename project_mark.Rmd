---
title: "marks_proj_work"
author: "Mark Austin"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE, results=FALSE}
#using Halid's code to keep data frame consistent
library(tidyverse)
df_eff <- read_csv('effervescence.csv', col_types = 'fffnnn')
```

# Exploratory Analysis  

###   Data Preparation

The Effervescent Experiment data contains 48 rows, 6 columns and no missing data points.  As a result of having intact data there will not be a need for data remediation.

The data sets contains three explanatory variables; Brand, Temp and Stirred.  Brand accounts for cold medication that are either name brand vs store brand.  Stirred considers observations where the water was agitated or not.  Temperature data points record the water temperature at specific predetermined levels--6$^{\circ}$C, 23$^{\circ}$C,  and 40$^{\circ}$C.  The data set also contains a response variables labeled Time.  Here are the first few rows of the data to illustrate the structure of our dataset. 

```{r message=FALSE, warning=FALSE, echo=FALSE}
df_eff %>% head()
```

### Summmary Statistics

```{r message=FALSE, warning=TRUE}
# Time, Generalized
summary(df_eff$Time)

#Time, by Brand
df_eff %>%
  group_by(Brand) %>%
  summarize(min = min(Time),
            q1 = quantile(Time, 0.25),
            median = median(Time),
            mean = mean(Time),
            q3 = quantile(Time, 0.75),
            max = max(Time))

#Time, by Temp
df_eff %>%
  group_by(Temp) %>%
  summarize(min = min(Time),
            q1 = quantile(Time, 0.25),
            median = median(Time),
            mean = mean(Time),
            q3 = quantile(Time, 0.75),
            max = max(Time))

#Time, by Stirred
df_eff %>%
  group_by(Stirred) %>%
  summarize(min = min(Time),
            q1 = quantile(Time, 0.25),
            median = median(Time),
            mean = mean(Time),
            q3 = quantile(Time, 0.75),
            max = max(Time))
```

###   Visualization

< add >

##   Model Assumptions

####  Outliers

\
All of the data falls within two standard deviations of the mean and there does not appear to be any outliers. 

```{r message=FALSE, warning=FALSE}
sd(df_eff$Time)
```
< expand using Cooks D, further outlier discussion/check here. >

####    Normality
\
We want to check the residuals of our data for normality since many of the tests performed will rely on this as an assumption.  Using a quantile-quantile plot, we can see that our observed residual values deviate from what would be considered normal.  Although the plot trends upward diagonally, there are two rapid transitions in our residuals which indicate the possibility of bimodality.  From the tail-ends of our Q-Q plot a right-skew and/or outliers may also be present.  Before beginning our analysis, a histogram check may reveal the presence of a multimodal distribution and tests such as Shapiro-Wilk can check for normality while a boxplot can check shape of distribution and check for outliers. 

```{r message=FALSE, warning=FALSE}
options(repr.plot.width = 8, repr.plot.height = 6, repr.plot.res = 200)
qqnorm(df_eff$Time, pch = 20)
qqline(df_eff$Time, col = "maroon", lwd = 2)
```

A histogram of the Time response variable further illustrates multi-modality.  This would be indicative of a pattern in the Time variable as a result of the explanatory variables.  In a thorough analysis, we will test the means of time on these factors to see how they vary.  

```{r message=FALSE, warning=FALSE}
hist(df_eff$Time)
```

####   Homogenniety of Variance 

< homoscadascity visual illustration > 

####  Homogenity of covariances

Analogue of homoscadascity for multivariate analysis
\
\
\
\
\


## Exploratory Analysis (Original)
```{r message=FALSE, warning=FALSE}
#using Halid's code to keep data frame consistent
library(tidyverse)
df_eff <- read_csv('effervescence.csv', col_types = 'fffnnn')
df_eff %>% head()

##3 factor interaction plot based on HW7 code

with(df_eff%>%filter(Stirred=="yes"),interaction.plot(Temp,Brand,Time,
            type="b", pch=19, col=c(2,4), ylab="mean Quality",
           main="Mean Time vs. Brand: Stirred = yes"))

with(df_eff%>%filter(Stirred=="no"),interaction.plot(Temp,Brand,Time,
          type="b", pch=19, col=c(2,4), ylab="mean Quality",
          main="Mean Time vs. Brand: Stirred = no"))


```
From the three factor interaction plots, does the 3 factor interaction look obvious here?  The brand by temp interaction is clear.



\
\
\
\
\

## Analysis and Results  
```{r message=TRUE, warning=TRUE}

#model with stirred as block effect without interaction 
aov_block_eff <- aov(lm_block_eff <- lm(Time ~ Brand * Temp + Stirred, data = df_eff))
summary(lm_block_eff)
summary(aov_block_eff)

plot(aov_block_eff)

library(olsrr)
ols_plot_cooksd_chart(lm_block_eff)

#added covariate Order model with stirred as block effect without interaction 
aov_block_order_eff <- aov(lm_block_order_eff <- lm(Time ~ Brand * Temp + Stirred + Order, data = df_eff))
summary(lm_block_order_eff)
summary(aov_block_order_eff)
library(car)
Anova(aov_block_order_eff, type=3) # type 3 SS
plot(lm_block_order_eff)
ols_plot_cooksd_chart(lm_block_order_eff)


#added covariate Order to model with 3 factor interaction
aov_three_order_eff <- aov(lm_three_order_eff <- lm(Time ~ Brand * Temp*Stirred + Order, data = df_eff))
summary(lm_three_order_eff)
summary(aov_three_order_eff)
library(car)
Anova(aov_three_order_eff, type=3) # type 3 SS
plot(lm_three_order_eff)

#adding Halid's code to see how full 3 factor interaction compares
aov_eff <- aov(lm_eff <- lm(Time ~ Brand * Temp * Stirred, data = df_eff))
summary(lm_eff)
summary(aov_eff)

plot(aov_eff)

#adding Cook's D here
ols_plot_cooksd_chart(lm_eff)

```


